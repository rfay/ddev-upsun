# Set database environment variables
export DB_HOST="${POSTGRES_HOST:-db}"
export DB_PORT="${POSTGRES_PORT:-db}"
export DB_PATH="${POSTGRES_PATH:-db}"
export DB_DATABASE="$DB_PATH"
export DB_USERNAME="${POSTGRES_USERNAME:-db}"
export DB_PASSWORD="${POSTGRES_PASSWORD:-db}"
export DB_SCHEME="${POSTGRES_SCHEME:-db}"
export DATABASE_URL="${DB_SCHEME}://${DB_USERNAME}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_PATH}"

# SEARCH/opensearch
export SEARCH_HOST="${OPENSEARCH_HOST:-opensearch}"
export SEARCH_PORT="${OPENSEARCH_PORT:-9200}"
export SEARCH_SCHEME="${OPENSEARCH_SCHEME:-http}"
export SEARCH_URL="${SEARCH_SCHEME}://${SEARCH_HOST}:${SEARCH_PORT}"

# Set Cache environment variables
export CACHE_HOST="${REDIS_HOST:-redis}"
export CACHE_PORT="${REDIS_PORT:-6379}"
export CACHE_SCHEME="${REDIS_SCHEME:-redis}"
export CACHE_URL="${CACHE_SCHEME}://${CACHE_HOST}:${CACHE_PORT}"

# MEMCACHED/MEMORY
export MEMORY_HOST="${MEMCACHED_HOST:-memcached}"
export MEMORY_PORT="${MEMCACHED_PORT:-11211}"
export MEMORY_SCHEME="${MEMCACHED_SCHEME:-memcached}"
export MEMORY_URL="${MEMORY_SCHEME}://${MEMORY_HOST}:${MEMORY_PORT}"

# Set Redis environment variables
export REDIS_URL="$CACHE_URL"

# Allow executable app dependencies from Composer to be run from the path.
if [ -n "$PLATFORM_APP_DIR" -a -f "$PLATFORM_APP_DIR"/composer.json ] ; then
  bin=$(composer config bin-dir --working-dir="$PLATFORM_APP_DIR" --no-interaction 2>/dev/null)
  export PATH="${PLATFORM_APP_DIR}/${bin:-vendor/bin}:${PATH}"
fi
